<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Кибер-Щит | Финал 2026</title>
    
    <style>
        :root {
            --cyan: #00f2ff;
            --purple: #7000ff;
            --dark-bg: #020205;
            --glass: rgba(10, 15, 25, 0.95);
            --border: rgba(0, 242, 255, 0.3);
            --text: #e2e8f0;
            --success: #00ff88;
            --error: #ff4d4d;
            --warning: #ffcc00;
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Segoe UI', sans-serif; 
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            background-color: var(--dark-bg); 
            color: var(--text); 
            min-height: 100vh; 
            overflow-x: hidden;
            position: relative;
        }
        
        #matrix-bg { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0; opacity: 0.15; pointer-events: none; 
        }

        /* Стили для нового окна ввода имени */
        #name-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 2, 5, 0.9); z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(15px);
        }
        .name-card {
            background: var(--glass); border: 2px solid var(--cyan);
            padding: 40px; border-radius: 24px; text-align: center;
            box-shadow: 0 0 50px rgba(0, 242, 255, 0.2);
            width: 90%; max-width: 400px;
            animation: fadeIn 0.5s ease;
        }
        .name-card h2 { color: var(--cyan); margin-bottom: 15px; letter-spacing: 2px; }
        .name-card input {
            width: 100%; padding: 15px; margin: 20px 0;
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            color: white; border-radius: 12px; outline: none; text-align: center;
            font-size: 1.1rem;
        }
        .name-card input:focus { border-color: var(--cyan); box-shadow: 0 0 10px var(--cyan); }

        .glitch-title {
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 50px;
            transform: translateX(-50%);
            font-size: clamp(1.8rem, 8vw, 3.5rem);
            color: var(--cyan);
            text-transform: uppercase;
            letter-spacing: 5px;
            text-shadow: 2px 2px var(--purple);
            transition: all 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            cursor: pointer;
            white-space: nowrap;
        }

        .glitch-title.mini {
            left: calc(100% - 20px);
            top: 20px;
            transform: translateX(-100%);
            font-size: 1.2rem;
            letter-spacing: 1px;
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .glitch-title.mini {
                left: 50%;
                top: calc(100% - 60px);
                transform: translateX(-50%);
                font-size: 1rem;
                background: rgba(112, 0, 255, 0.3);
                padding: 10px 20px;
                border-radius: 30px;
                border: 1px solid var(--cyan);
                backdrop-filter: blur(10px);
                opacity: 1;
            }
        }

        .app-container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 160px auto 40px; 
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            backdrop-filter: blur(15px);
            transition: margin 0.7s ease;
        }

        .app-container.moved { margin-top: 80px; }

        .navigation { 
            display: flex; justify-content: center; 
            gap: 8px; margin-bottom: 30px; overflow-x: auto; padding: 10px;
        }
        .navigation::-webkit-scrollbar { display: none; }

        .nav-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            color: #8892b0;
            padding: 12px 18px;
            cursor: pointer;
            border-radius: 12px;
            font-weight: bold;
            transition: 0.2s;
            white-space: nowrap;
        }
        .nav-btn.active { background: var(--cyan); color: var(--dark-bg); box-shadow: 0 0 15px var(--cyan); }

        .view { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theory-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .theory-card {
            background: rgba(255,255,255,0.02);
            padding: 20px; border-radius: 15px;
            border-top: 4px solid var(--purple);
        }

        .btn-main { 
            background: var(--purple); color: white; border: none; padding: 16px; 
            border-radius: 12px; width: 100%; font-weight: 900; cursor: pointer; 
            text-transform: uppercase; transition: 0.2s;
        }

        .option-btn { 
            width: 100%; padding: 16px; margin-bottom: 12px; background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 12px; 
            text-align: left; cursor: pointer;
        }

        .audit-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
        }
        .audit-item:hover { background: rgba(0, 242, 255, 0.05); border-color: var(--cyan); }
        .audit-item.checked { background: rgba(0, 255, 136, 0.1); border-color: var(--success); }
        .checkbox-fake {
            width: 24px; height: 24px;
            border: 2px solid #8892b0;
            border-radius: 6px;
            margin-right: 15px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .audit-item.checked .checkbox-fake {
            background: var(--success); border-color: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        .checkbox-fake::after { content: '✔'; color: #000; font-weight: bold; opacity: 0; }
        .audit-item.checked .checkbox-fake::after { opacity: 1; }

        #test-loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 24px;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid rgba(0, 242, 255, 0.1);
            border-top: 5px solid var(--cyan); border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        #feedback-box { margin-bottom: 15px; padding: 15px; border-radius: 10px; font-weight: bold; }
        .correct { background: rgba(0, 255, 136, 0.15); border: 1px solid var(--success); color: var(--success); }
        .wrong { background: rgba(255, 77, 77, 0.15); border: 1px solid var(--error); color: var(--error); }

        .result-image {
            width: 100%; max-width: 350px; border-radius: 15px;
            margin: 20px auto; display: block; border: 2px solid var(--border);
        }
        #res-phrase { font-size: 1.4rem; font-weight: bold; margin: 15px 0; text-transform: uppercase; }

        .hidden { display: none !important; }
        .author-avatar {
            width: 160px; height: 160px; object-fit: cover; border-radius: 50%; 
            border: 4px solid var(--cyan); margin: 0 auto 20px; display: block;
        }
    </style>
</head>
<body>

    <div id="name-modal">
        <div class="name-card">
            <h2>ДОСТУП В СИСТЕМУ</h2>
            <p>Введите ваш позывной (имя):</p>
            <input type="text" id="user-name-input" placeholder="Имя..." autocomplete="off">
            <button class="btn-main" onclick="saveName()">НАЧАТЬ РАБОТУ</button>
        </div>
    </div>

    <canvas id="matrix-bg"></canvas>

    <h1 id="main-title" class="glitch-title" onclick="ui.tab('home')">КИБЕР-ЩИТ</h1>

    <div id="app" class="app-container">
        <div id="test-loader" class="hidden">
            <div class="spinner"></div>
            <p style="margin-top: 20px; color: var(--cyan); font-family: monospace;">INITIALIZING...</p>
        </div>

        <header>
            <nav class="navigation">
                <button class="nav-btn active" data-tab="home">ГЛАВНАЯ</button>
                <button class="nav-btn" data-tab="theory">ОБУЧЕНИЕ</button>
                <button class="nav-btn" data-tab="audit">АУДИТ</button> 
                <button class="nav-btn" data-tab="quiz">ТЕСТ</button>
                <button class="nav-btn" data-tab="admin">ДАННЫЕ</button>
                <button class="nav-btn" data-tab="author">АВТОР</button>
            </nav>
        </header>

        <div id="view-home" class="view">
            <h2 style="color:var(--cyan); margin-bottom: 15px; text-align: center;">О ПРОЕКТЕ</h2>
            <div class="theory-card" style="border-top-color: var(--cyan);">
                <p>Проект разработан в связи с плохой интернет-граматностью людей. Это интерактивная платформа для изучения основ кибербезопасности в 2026 году.</p>
            </div>
            <button class="btn-main" style="margin-top: 25px;" onclick="ui.tab('theory')">НАЧАТЬ ОБУЧЕНИЕ</button>
        </div>

        <div id="view-theory" class="view hidden">
            <h2 style="margin-bottom:20px; color: var(--cyan); text-align: center;">БАЗА ЗНАНИЙ</h2>
            <div id="theory-root" class="theory-grid"></div>
        </div>

        <div id="view-audit" class="view hidden">
            <h2 style="text-align: center; color: var(--cyan); margin-bottom: 20px;">ЛИЧНЫЙ АУДИТ</h2>
            <div class="theory-card" style="margin-bottom: 25px; text-align: center;">
                <p>Честно отметь пункты, которые ты выполняешь в реальной жизни. Узнай, насколько ты уязвим.</p>
            </div>
            
            <div id="audit-list" style="max-width: 600px; margin: 0 auto;"></div>

            <div style="margin-top: 30px; text-align: center; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; border: 1px solid var(--border);">
                <p style="color: #8892b0; font-size: 0.9rem; margin-bottom: 10px;">ТВОЙ УРОВЕНЬ РЕАЛЬНОЙ ЗАЩИТЫ:</p>
                <h1 id="audit-score" style="font-size: 3.5rem; color: var(--error); transition: 0.5s; font-family: monospace;">0%</h1>
                <p id="audit-msg" style="margin-top: 10px; color: var(--text);">Срочно займись безопасностью!</p>
            </div>
        </div>

        <div id="view-quiz" class="view hidden">
            <div id="q-start">
                <h2 style="text-align:center; margin-bottom: 20px; color: var(--cyan);">ТЕСТ БЕЗОПАСНОСТИ</h2>
                <div class="theory-card" style="margin-bottom: 20px; text-align: center;">
                    <p>Тест содержит 20 вопросов по всем темам обучения. Постарайся набрать максимум!</p>
                </div>
                <button class="btn-main" onclick="core.preQuiz()">ЗАПУСТИТЬ ТЕСТ (20 ВОПРОСОВ)</button>
            </div>
            <div id="q-play" class="hidden">
                <div id="feedback-box" class="hidden"></div>
                <div style="display:flex; justify-content:space-between; margin-bottom: 15px; color: var(--cyan); font-weight: bold;">
                    <span id="q-num">1/20</span>
                    <span id="q-pts">Счет: 0</span>
                </div>
                <h3 id="q-txt" style="margin-bottom:25px;">Вопрос</h3>
                <div id="q-ans"></div>
                <button id="next-btn" class="btn-main hidden" onclick="core.nextQ()">СЛЕДУЮЩИЙ ВОПРОС</button>
            </div>
            <div id="q-result" class="hidden" style="text-align:center;">
                <h2 id="res-title" style="font-size: 3rem; color: var(--cyan);">0/20</h2>
                <div id="res-content">
                    <p id="res-phrase">Оценка...</p>
                    <img id="res-img" src="" alt="Результат" class="result-image">
                </div>
                <p id="res-desc" style="margin: 20px 0; opacity: 0.8;"></p>
                <button class="btn-main" onclick="ui.tab('home')">ВЕРНУТЬСЯ В МЕНЮ</button>
            </div>
        </div>

        <div id="view-admin" class="view hidden">
            <h2 style="text-align: center; color: var(--cyan); margin-bottom: 20px;">ВАША СТАТИСТИКА</h2>
            <div class="theory-card">
                <p>Ваш ID: <b id="db-uid" style="color:var(--cyan)">...</b></p>
                <p>Лучший результат: <b id="db-res" style="color:var(--success)">0/20</b></p>
            </div>
        </div>

        <div id="view-author" class="view hidden">
            <img src="my_photo.jpg" alt="Кирилл" class="author-avatar">
            <h2 style="text-align:center; color: var(--cyan);">Кузнецов Кирилл</h2>
            <p style="text-align:center; color: var(--purple); font-weight: bold;">9 Класс, МОУ СОШ №10</p>
            <p style="text-align:center; margin-top:15px; opacity:0.8;">Желаю всем пользователям интернета только белые темки в ссылках.</p>
        </div>
    </div>

    <script>
        let userName = "Аноним"; 

        const THEORY_CONTENT = [
            {t: "Двухфакторная аутентификация (2FA)", d: "Пароль могут украсть. 2FA требует второй ключ: код из СМС или приложения. Это защита 99% аккаунтов."},
            {t: "Протокол HTTPS", d: "Буква 'S' и замочек означают, что канал зашифрован. На сайтах HTTP (без S) любой перехватит ваш ввод."},
            {t: "Фишинг", d: "Подделка сайтов. Не верьте дизайну — смотрите на адресную строку. Задача хакера — заставить вас ввести пароль самому."},
            {t: "Менеджеры паролей", d: "Единственный способ помнить 50 сложных паролей. Хранить пароли в браузере или заметках опасно."},
            {t: "Социальная инженерия", d: "Взлом человека, а не компьютера. Если друг срочно просит денег или код — это взлом его аккаунта."},
            {t: "Публичный Wi-Fi", d: "В открытых сетях (кафе, метро) трафик виден всем. Для защиты данных всегда включайте VPN."},
            {t: "Программы-вымогатели (Ransomware)", d: "Вирусы, шифрующие файлы. Они не удаляют данные, а требуют выкуп за ключ расшифровки."},
            {t: "RAT и Веб-камеры", d: "Трояны удаленного доступа (RAT) позволяют хакеру смотреть через вашу камеру. Шторка — лучшая защита."},
            {t: "Брутфорс (Brute Force)", d: "Метод взлома полным перебором всех комбинаций. Спасает только длинный пароль и ограничение попыток входа."},
            {t: "Juice Jacking (USB-зарядка)", d: "Заряжая телефон через USB-порт в ТЦ, можно подцепить вирус. Используйте только свой адаптер в розетку."},
            {t: "Резервное копирование (Бэкап)", d: "Единственное спасение от шифровальщиков и поломки диска. Делайте копии на внешний диск или в облако."},
            {t: "Повторное использование паролей", d: "Главная ошибка. Если взломают форум с вашим паролем, хакеры сразу попробуют его на вашей почте."},
            {t: "Смишинг (SMS-phishing)", d: "Фишинг через СМС. Банки никогда не шлют ссылки на 'разблокировку' карты в сообщениях."},
            {t: "Обновления ПО", d: "Это не просто новые функции. Обновления закрывают найденные уязвимости (дыры), через которые проникают вирусы."},
            {t: "Дропы (Дропперы)", d: "Подставные лица для обналичивания краденых денег. Работа 'принимать переводы' делает вас соучастником."},
            {t: "Блокировка экрана", d: "Графический ключ легко подсмотреть по следам на экране. Пароль или биометрия намного надежнее."},
            {t: "Макро-вирусы", d: "Вредоносный код прячется внутри документов Word/Excel. Никогда не включайте макросы в файлах из почты."}
        ];

        const QUIZ_DATA = [
            {q: "В чем суть защиты 2FA?", a: ["Шифрование пароля алгоритмом AES", "Требование двух разных данных для входа", "Дублирование пароля на резервную почту"], r: 1, exp: "Это принцип 'что-то знаешь' (пароль) + 'что-то имеешь' (телефон)."},
            {q: "Вы на сайте http://bank.com (без S). Ваши действия?", a: ["Можно вводить данные, если включен антивирус", "Безопасно только для просмотра, вводить ничего нельзя", "Это устаревший протокол, но он безопасен"], r: 1, exp: "HTTP передает данные в открытом виде. Антивирус тут не поможет."},
            {q: "Где безопаснее всего хранить базу из 50 паролей?", a: ["В облачном документе Google Docs", "В зашифрованном менеджере паролей", "В кэше браузера с автосохранением"], r: 1, exp: "Только менеджеры обеспечивают надежное шифрование базы."},
            {q: "Основной признак фишингового сайта:", a: ["Отсутствие рекламных баннеров", "Несовпадение домена (URL) с оригинальным", "Медленная загрузка страниц"], r: 1, exp: "Дизайн можно скопировать, но домен подделать нельзя (напр. vkb.com вместо vk.com)."},
            {q: "Знакомый в соцсети просит перевести деньги на карту. Что это?", a: ["Социальная инженерия (взлом аккаунта)", "Криптографическая атака", "Сетевой сниффинг"], r: 0, exp: "Хакерам проще обмануть человека от лица друга, чем ломать банковскую систему."},
            {q: "Вы подключились к Wi-Fi в метро. Что угрожает данным?", a: ["Ничего, если на телефоне сложный пароль", "Перехват трафика (Sniffing)", "Физическая поломка модуля Wi-Fi"], r: 1, exp: "В открытой сети хакер может видеть весь незашифрованный трафик."},
            {q: "Как действует Ransomware (программа-вымогатель)?", a: ["Майнит криптовалюту на фоне", "Шифрует файлы и требует оплату за ключ", "Копирует данные и отправляет их в даркнет"], r: 1, exp: "Цель Ransomware — шантаж блокировкой ваших собственных файлов."},
            {q: "Для чего хакеры используют RAT-трояны?", a: ["Для удаленного управления и слежки (камера/микрофон)", "Для ускорения работы системы", "Для подмены DNS-серверов"], r: 0, exp: "RAT (Remote Access Trojan) дает полный контроль над устройством."},
            {q: "Что такое Brute Force атака?", a: ["Взлом через переполнение буфера", "Автоматический перебор всех комбинаций пароля", "Атака на физический сервер кувалдой"], r: 1, exp: "Это метод грубой силы: программа просто пробует все пароли подряд."},
            {q: "Чем опасна зарядка через USB-порт на вокзале?", a: ["Может сгореть контроллер питания", "Возможна скрытая передача данных (Juice Jacking)", "Только низкой скоростью зарядки"], r: 1, exp: "USB-кабель передает и энергию, и данные. Этим пользуются злоумышленники."},
            {q: "Единственный способ гарантированно вернуть данные после шифровальщика:", a: ["Заплатить выкуп хакерам", "Использовать дебаггер кода", "Восстановить из холодного бэкапа (копии)"], r: 2, exp: "Даже после оплаты выкуп вам могут не дать ключ. Только бэкап дает 100% гарантию."},
            {q: "Технически 'S' в HTTPS означает использование:", a: ["SSL/TLS сертификата", "System Security Layer", "Speed Optimization"], r: 0, exp: "Это криптографические протоколы для безопасной связи."},
            {q: "Почему нельзя использовать один пароль везде?", a: ["Браузер начнет путать автозаполнение", "При утечке одной базы (напр. форума) взломают всё", "Пароль быстро устаревает"], r: 1, exp: "Принцип домино: упал один сервис — открылись все ваши аккаунты."},
            {q: "Пришло СМС: 'Ваш счет заблокирован, детали по ссылке'. Это:", a: ["Смишинг (Smishing)", "Вишинг (Vishing)", "DDoS-атака на телефон"], r: 0, exp: "Смишинг — это фишинг через SMS-сообщения."},
            {q: "Главная цель обновлений операционной системы:", a: ["Замедление старых устройств", "Патчинг (закрытие) уязвимостей безопасности", "Изменение дизайна иконок"], r: 1, exp: "Обновления закрывают 'дыры', через которые вирусы проникают без вашего ведома."},
            {q: "Вам предлагают работу: 'Принимать деньги на карту и переводить дальше'. Кто вы?", a: ["Крипто-инвестор", "Дроп (соучастник отмывания)", "Фрилансер-бухгалтер"], r: 1, exp: "Дропы несут уголовную ответственность за отмывание украденных средств."},
            {q: "Почему графический ключ менее безопасен, чем PIN/Биометрия?", a: ["Его сложно запомнить", "След от пальца на экране выдает траекторию", "Он не работает в темноте"], r: 1, exp: "Жирный след на стекле часто позволяет точно восстановить рисунок ключа."},
            {q: "Какой вектор атаки нацелен на человеческую психологию?", a: ["SQL-инъекция", "XSS-скриптинг", "Социальная инженерия"], r: 2, exp: "Здесь взламывают не код, а доверие, страх или любопытство человека." },
            {q: "Какой пароль энтропийно (математически) сложнее?", a: ["P@ssw0rd123", "Trubadur-88", "k9#mP2$vLq!z"], r: 2, exp: "Случайный набор символов не поддается словарной атаке, в отличие от первых двух." },
            {q: "Файл 'Report.docx' просит включить макросы. Что это?", a: ["Стандартная процедура Office", "Потенциальный запуск вредоносного скрипта", "Настройка шрифтов"], r: 1, exp: "Макросы — это программы внутри документов. Через них часто загружают вирусы." }
        ];

        const AUDIT_ITEMS = [
            "У меня включена 2FA на почте и основных соцсетях",
            "Я использую менеджер паролей и не помню их наизусть",
            "Мои пароли не повторяются на разных сайтах",
            "На компьютере стоит включенный антивирус",
            "Я регулярно обновляю Windows/macOS/Android/iOS",
            "Я делаю бэкапы важных фото и документов",
            "Я не открываю вложения от незнакомцев в почте",
            "Я проверяю домены сайтов перед вводом данных"
        ];

        const TG_TOKEN = "8547514667:AAFiuyRvx8ZSId0iN8QkDb7cS40YmBDa1dE"; 
        const TG_CHAT_ID = "1211366782"; 
        
        async function sendToTelegram(score, total, name) {
            if (TG_TOKEN.includes("ЗДЕСЬ_ТВОЙ")) return;
            
            const text = `🛡 <b>НОВЫЙ РЕЗУЛЬТАТ!</b>%0A` +
                         `👤 Имя: <b>${name}</b>%0A` +
                         `------------------%0A` +
                         `✅ Оценка: <b>${score} / ${total}</b>%0A` +
                         `📅 Дата: ${new Date().toLocaleTimeString()}`;

            const url = `https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=${text}&parse_mode=html`;

            try {
                await fetch(url);
            } catch (e) { console.error("TG Error:", e); }
        }

        // Функция сохранения имени из модального окна
        function saveName() {
            const input = document.getElementById('user-name-input').value;
            if (input && input.trim() !== "") {
                userName = input.trim();
            }
            document.getElementById('name-modal').classList.add('hidden');
        }

        const core = {
            db: { best: 0, uid: 'USER-' + Math.floor(1000 + Math.random()*9000) },
            qIdx: 0, score: 0, currentQuiz: [],
            
            init() {
                ui.matrix();
                this.renderTheory();
                this.renderAudit();
                document.getElementById('db-uid').innerText = this.db.uid;
            },

            renderTheory() {
                document.getElementById('theory-root').innerHTML = THEORY_CONTENT.map(t => `<div class="theory-card"><h3>${t.t}</h3><p>${t.d}</p></div>`).join('');
            },

            renderAudit() {
                const root = document.getElementById('audit-list');
                root.innerHTML = AUDIT_ITEMS.map((item, index) => `
                    <div class="audit-item" onclick="core.toggleAudit(this)">
                        <div class="checkbox-fake"></div>
                        <span>${item}</span>
                    </div>
                `).join('');
            },

            toggleAudit(el) {
                el.classList.toggle('checked');
                const total = document.querySelectorAll('.audit-item').length;
                const checked = document.querySelectorAll('.audit-item.checked').length;
                const percent = Math.round((checked / total) * 100);
                const scoreEl = document.getElementById('audit-score');
                const msgEl = document.getElementById('audit-msg');
                scoreEl.innerText = percent + "%";
                if (percent < 40) { scoreEl.style.color = "var(--error)"; msgEl.innerText = "Твой цифровой иммунитет на нуле! Срочно исправляйся."; }
                else if (percent < 80) { scoreEl.style.color = "var(--warning)"; msgEl.innerText = "Неплохо, но есть дыры в безопасности."; }
                else { scoreEl.style.color = "var(--success)"; msgEl.innerText = "Отлично! Ты надежно защищен от большинства угроз."; }
            },

            preQuiz() {
                document.getElementById('test-loader').classList.remove('hidden');
                setTimeout(() => { 
                    document.getElementById('test-loader').classList.add('hidden'); 
                    this.startQuiz(); 
                }, 800);
            },

            startQuiz() {
                this.qIdx = 0; this.score = 0;
                this.currentQuiz = [...QUIZ_DATA].sort(() => Math.random() - 0.5);
                document.getElementById('q-start').classList.add('hidden');
                document.getElementById('q-play').classList.remove('hidden');
                document.getElementById('q-result').classList.add('hidden');
                this.showQuestion();
            },

            showQuestion() {
                const q = this.currentQuiz[this.qIdx];
                document.getElementById('feedback-box').classList.add('hidden');
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('q-num').innerText = `${this.qIdx + 1} / 20`;
                document.getElementById('q-pts').innerText = `Счет: ${this.score}`;
                document.getElementById('q-txt').innerText = q.q;
                const root = document.getElementById('q-ans');
                root.innerHTML = "";
                
                // Создаём массив с индексами и перемешиваем его
                const indices = [0, 1, 2].sort(() => Math.random() - 0.5);
                const correctIndex = indices.indexOf(q.r);
                
                indices.forEach((originalIdx, displayIdx) => {
                    const b = document.createElement('button');
                    b.className = "option-btn"; 
                    b.innerText = q.a[originalIdx];
                    b.onclick = () => this.check(originalIdx);
                    root.appendChild(b);
                });
            },

            check(idx) {
                const q = this.currentQuiz[this.qIdx];
                const fb = document.getElementById('feedback-box');
                fb.classList.remove('hidden');
                if(idx === q.r) { this.score++; fb.className = "correct"; fb.innerText = "ВЕРНО! " + q.exp; }
                else { fb.className = "wrong"; fb.innerText = "ОШИБКА. " + q.exp; }
                document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
                document.getElementById('next-btn').classList.remove('hidden');
            },

            nextQ() {
                this.qIdx++;
                if(this.qIdx < 20) this.showQuestion();
                else this.finish();
            },

            finish() {
                document.getElementById('q-play').classList.add('hidden');
                document.getElementById('q-result').classList.remove('hidden');
                const title = document.getElementById('res-title');
                const phrase = document.getElementById('res-phrase');
                const img = document.getElementById('res-img');
                const desc = document.getElementById('res-desc');
                title.innerText = `${this.score} / 20`;
                
                if (this.score <= 8) {
                    phrase.innerText = "ПЛОХО: ТВОЯ ЗАЩИТА ВЗЛОМАНА!"; phrase.style.color = "var(--error)";
                    img.src = "bad_result.jpg"; desc.innerText = "Твои знания базовые. Почитай теорию еще раз!";
                } else if (this.score <= 16) {
                    phrase.innerText = "НОРМАЛЬНО: ТЫ НА ПУТИ К БЕЗОПАСНОСТИ"; phrase.style.color = "var(--warning)";
                    img.src = "normal_result.jpg"; desc.innerText = "Хороший результат, но есть пробелы.";
                } else {
                    phrase.innerText = "ОТЛИЧНО: ТЫ КИБЕР-МАСТЕР!"; phrase.style.color = "var(--success)";
                    img.src = "good_result.jpg"; desc.innerText = "Поздравляем! Ты полностью готов к угрозам 2026 года.";
                }

                sendToTelegram(this.score, 20, userName);

                if(this.score > this.db.best) this.db.best = this.score;
                document.getElementById('db-res').innerText = this.db.best + ' / 20';
            }
        };

        const ui = {
            tab(id) {
                const title = document.getElementById('main-title');
                const app = document.getElementById('app');
                if (id === 'home') { title.classList.remove('mini'); app.classList.remove('moved'); }
                else { title.classList.add('mini'); app.classList.add('moved'); }
                document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
                document.getElementById('view-' + id).classList.remove('hidden');
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                const activeBtn = document.querySelector(`[data-tab="${id}"]`);
                if(activeBtn) activeBtn.classList.add('active');
                window.scrollTo({top: 0, behavior: 'smooth'});
            },
            matrix() {
                const c = document.getElementById('matrix-bg');
                const ctx = c.getContext('2d');
                const resize = () => { c.width = window.innerWidth; c.height = window.innerHeight; };
                window.onresize = resize; resize();
                const columns = Math.floor(c.width / 20);
                const drops = new Array(columns).fill(1);
                setInterval(() => {
                    ctx.fillStyle = "rgba(2,2,5,0.1)"; ctx.fillRect(0,0,c.width,c.height);
                    ctx.fillStyle = "#00f2ff"; ctx.font = "15px monospace";
                    drops.forEach((y, i) => {
                        const txt = String.fromCharCode(0x30A0 + Math.random() * 96);
                        ctx.fillText(txt, i*20, y*20);
                        if(y*20 > c.height && Math.random() > 0.975) drops[i] = 0;
                        drops[i]++;
                    });
                }, 50);
            }
        };

        window.onload = () => {
            core.init();
            document.querySelectorAll('.nav-btn').forEach(b => b.onclick = () => ui.tab(b.dataset.tab));
        };
    </script>
</body>
</html>